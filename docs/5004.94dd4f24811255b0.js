"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5004],{5004:(T,u,a)=>{a.r(u),a.d(u,{PreviewpollPageModule:()=>Q});var _=a(4666),d=a(2508),g=a(8139),l=a(2004),s=a(6476),e=a(2135),x=a(2518);function m(i,n){if(1&i&&(e.TgZ(0,"ion-text",7),e._UZ(1,"i",10),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.Q6J("lang",t.p.language)("innerHtml",t.p.desc,e.oJD)}}function h(i,n){1&i&&(e.TgZ(0,"span"),e._uU(1,"\xa0"),e.qZA())}function P(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"ion-text",19),e.YNc(1,h,2,0,"span",3),e._uU(2," ("),e.TgZ(3,"span",20),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(3);return e.KtG(r.G.open_url_in_new_tab(r.G.D.fix_url(r.p.url)))}),e._UZ(4,"ion-text",21),e.ALo(5,"translate"),e._uU(6,"\xa0"),e._UZ(7,"ion-icon",22),e.qZA(),e._uU(8,") "),e.qZA()}if(2&i){const t=e.oxw(3);e.xp6(1),e.Q6J("ngIf",""!=(t.p.desc||"")&&""!=(t.p.url||"")),e.xp6(3),e.Q6J("innerHtml",e.lcZ(5,2,"read-more"),e.oJD)}}function f(i,n){if(1&i&&(e.TgZ(0,"p"),e.YNc(1,m,2,2,"ion-text",17),e.YNc(2,P,9,4,"ion-text",18),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("ngIf",""!=(t.p.desc||"")),e.xp6(1),e.Q6J("ngIf",""!=(t.p.url||""))}}function Z(i,n){if(1&i&&(e.ynx(0),e._UZ(1,"ion-text",2),e.ALo(2,"translate"),e._uU(3,"\xa0"),e._UZ(4,"ion-text",6),e.ALo(5,"translate"),e.BQk()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("innerHtml",e.lcZ(2,2,"previewpoll.closes"),e.oJD),e.xp6(3),e.Q6J("innerHtml","custom"!=t.p.due_type?e.lcZ(5,4,"draftpoll.due-type-"+t.p.due_type):t.G.D.format_date(t.p.due),e.oJD)}}function v(i,n){1&i&&(e._UZ(0,"ion-text",23),e.ALo(1,"translate")),2&i&&e.Q6J("innerHtml",e.lcZ(1,1,"previewpoll.is-in-past"),e.oJD)}function w(i,n){if(1&i&&(e.TgZ(0,"p")(1,"small"),e._UZ(2,"ion-text",2),e.ALo(3,"translate"),e._uU(4,":\xa0"),e._UZ(5,"ion-text",6),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(2),e.Q6J("innerHtml",e.lcZ(3,2,"draftpoll.language"),e.oJD),e.xp6(3),e.Q6J("innerHtml",t.G.S.language_names[t.p.language],e.oJD)}}function J(i,n){if(1&i&&(e.TgZ(0,"p"),e._UZ(1,"ion-select-option",24),e.ALo(2,"translate"),e._UZ(3,"ion-select-option",25),e.ALo(4,"translate"),e._UZ(5,"ion-select-option",26),e.ALo(6,"translate"),e.TgZ(7,"small"),e._UZ(8,"ion-text",2),e.ALo(9,"translate"),e._uU(10,":\xa0"),e._UZ(11,"ion-text",6),e.ALo(12,"translate"),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("innerHtml",e.lcZ(2,5,"select-server.central"),e.oJD),e.xp6(2),e.Q6J("innerHtml",e.lcZ(4,7,"settings"==t.page?"select-server.same-as-some-poll":"select-server.same-as-other-poll"),e.oJD),e.xp6(2),e.Q6J("innerHtml",e.lcZ(6,9,"select-server.other"),e.oJD),e.xp6(3),e.Q6J("innerHtml",e.lcZ(9,11,"previewpoll.db-label"),e.oJD),e.xp6(3),e.Q6J("innerHtml",e.lcZ(12,13,"poll"==t.p.db?"select-server.same-as-other-poll":"central"==t.p.db?"select-server.central":"select-server.other"),e.oJD)}}function y(i,n){if(1&i&&(e.TgZ(0,"ion-text",7),e._UZ(1,"br")(2,"i",10),e.qZA()),2&i){const t=e.oxw().$implicit,o=e.oxw(2);e.xp6(2),e.Q6J("lang",o.p.language)("innerHtml",t.desc,e.oJD)}}function A(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"ion-text",19),e._uU(1,"\xa0 ("),e.TgZ(2,"span",20),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().$implicit,p=e.oxw(2);return e.KtG(p.G.open_url_in_new_tab(p.G.D.fix_url(r.url)))}),e._UZ(3,"ion-text",21),e.ALo(4,"translate"),e._uU(5,"\xa0"),e._UZ(6,"ion-icon",22),e.qZA(),e._uU(7,") "),e.qZA()}2&i&&(e.xp6(3),e.Q6J("innerHtml",e.lcZ(4,1,"read-more"),e.oJD))}function G(i,n){if(1&i&&(e.TgZ(0,"ion-item")(1,"ion-col",5)(2,"p")(3,"ion-text",7)(4,"b"),e._UZ(5,"i",10),e.qZA()(),e.YNc(6,y,3,2,"ion-text",17),e.YNc(7,A,8,3,"ion-text",18),e.qZA()()()),2&i){const t=n.$implicit,o=e.oxw(2);e.xp6(5),e.Q6J("lang",o.p.language)("innerHtml",t.name,e.oJD),e.xp6(1),e.Q6J("ngIf",""!=(t.desc||"")),e.xp6(1),e.Q6J("ngIf",""!=(t.url||""))}}function D(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"ion-content")(1,"ion-list",4)(2,"ion-item")(3,"ion-col",5)(4,"p"),e._UZ(5,"ion-text",2),e.ALo(6,"translate"),e._uU(7,"\xa0"),e._UZ(8,"ion-text",6),e.ALo(9,"translate"),e.qZA(),e.TgZ(10,"ion-text",7)(11,"h3")(12,"span",8),e._UZ(13,"ion-icon",9),e._uU(14,"\xa0 "),e.qZA(),e.TgZ(15,"b"),e._UZ(16,"i",10),e.qZA()()(),e.YNc(17,f,3,2,"p",3),e.TgZ(18,"p"),e.YNc(19,Z,6,6,"ng-container",3),e.YNc(20,v,2,3,"ion-text",11),e.qZA(),e.YNc(21,w,6,4,"p",3),e.YNc(22,J,13,15,"p",3),e.TgZ(23,"p")(24,"small")(25,"b"),e._UZ(26,"ion-text",2),e.ALo(27,"translate"),e._uU(28,": "),e.qZA()()()()(),e.YNc(29,G,8,4,"ion-item",12),e.TgZ(30,"ion-item",13)(31,"ion-col",5),e._UZ(32,"p",2),e.ALo(33,"translate"),e.TgZ(34,"small"),e._UZ(35,"p",2),e.ALo(36,"translate"),e.qZA()()(),e.TgZ(37,"ion-item",14)(38,"ion-button",15),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.publish_button_clicked())}),e._UZ(39,"span",2),e.ALo(40,"translate"),e._uU(41,"\xa0 "),e._UZ(42,"ion-icon",16),e.qZA()()()()}if(2&i){const t=e.oxw();e.xp6(5),e.Q6J("innerHtml",e.lcZ(6,16,"previewpoll.type-label"),e.oJD),e.xp6(3),e.Q6J("innerHtml",e.lcZ(9,18,"draftpoll.type-"+t.p.type)+".",e.oJD),e.xp6(5),e.Q6J("name","winner"==t.p.type?"trophy":"cut"),e.xp6(3),e.Q6J("lang",t.p.language)("innerHtml",t.p.title,e.oJD),e.xp6(1),e.Q6J("ngIf",""!=(t.p.desc||"")||""!=(t.p.url||"")),e.xp6(2),e.Q6J("ngIf",t.p.due>=t.G.P.ref_date),e.xp6(1),e.Q6J("ngIf",t.p.due<t.G.P.ref_date),e.xp6(1),e.Q6J("ngIf",""!=(t.p.language||"")&&t.p.language!=t.G.S.language),e.xp6(1),e.Q6J("ngIf","default"!=t.p.db),e.xp6(4),e.Q6J("innerHtml",e.lcZ(27,20,"winner"==t.p.type?"options":"possible-targets"),e.oJD),e.xp6(3),e.Q6J("ngForOf",t.Object.values(t.p.options)),e.xp6(3),e.Q6J("innerHtml",e.lcZ(33,22,"previewpoll.caution1"),e.oJD),e.xp6(3),e.Q6J("innerHtml",e.lcZ(36,24,"previewpoll.caution2"),e.oJD),e.xp6(3),e.Q6J("disabled",t.p.due<t.G.P.ref_date),e.xp6(1),e.Q6J("innerHtml",e.lcZ(40,26,"previewpoll.publish"),e.oJD)}}const U=[{path:"",component:(()=>{class i{constructor(t,o,r,p){this.router=t,this.route=o,this.translate=r,this.G=p,this.Object=Object,this.page="previewpoll",this.ready=!1,this.G.L.entry("PreviewpollPage.constructor"),this.route.params.subscribe(c=>{this.pid=c.pid})}ngOnInit(){this.G.L.entry("PreviewpollPage.ngOnInit")}ionViewWillEnter(){this.G.L.entry("PreviewpollPage.ionViewWillEnter"),this.G.D.page=this}ionViewDidEnter(){this.G.L.entry("PreviewpollPage.ionViewDidEnter"),this.G.D.ready&&this.onDataReady(),this.G.L.debug("PreviewpollPage.ready:",this.ready)}onDataReady(){return this.G.L.entry("PreviewpollPage.onDataReady"),this.pid in this.G.P.polls?(this.p=this.G.P.polls[this.pid],this.p.set_due(),this.G.P.update_ref_date(),"draft"!=this.p.state?(this.G.L.warn("DraftpollPage non-draft pid ignored, redirecting to mypolls page",this.pid),void this.router.navigate(["/mypolls"])):(this.G.L.info("PreviewpollPage showing existing draft",this.pid),void(this.ready=!0))):(this.G.L.warn("PreviewpollPage unknown pid ignored, redirecting to mypolls page",this.pid,this.G.P.polls),void this.router.navigate(["/mypolls"]))}ionViewDidLeave(){this.G.L.entry("PreviewpollPage.ionViewDidLeave"),this.G.D.save_state(),this.G.L.exit("PreviewpollPage.ionViewDidLeave")}publish_button_clicked(){this.G.L.entry("PreviewpollPage.publish_button_clicked"),this.p.set_db_credentials(),this.p.init_password(),this.p.init_myvid(),this.p.start_date=new Date,this.G.D.wait_for_user_db().finally(()=>{this.p.state="running",this.G.D.wait_for_poll_db(this.pid).finally(()=>{if(this.p.creator=this.G.S.email,this.G.L.trace("PreviewpollPage.publish_button_clicked poll is_test",this.p.is_test,this.G.D.getp(this.pid,"is_test")),this.p.is_test){for(const t of this.p.oids){const o=JSON.parse(this.G.D.getp(this.pid,"simulated_ratings."+t));if(Array.isArray(o)){this.G.L.trace("PreviewpollPage.publish_button_clicked registering simulated voters...");for(const r in o){const p="simulated"+r,c=o[r];this.G.D.setv_in_polldb(this.pid,"rating."+t,c,p),this.G.P.update_own_rating(this.pid,p,t,c,!1),this.G.L.trace("PreviewpollPage.publish_button_clicked registered simulated voter",r)}}}this.p.tally_all()}this.router.navigate(["/inviteto/"+this.pid]),this.G.L.exit("PreviewpollPage.publish_button_clicked")})})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(s.F0),e.Y36(s.gz),e.Y36(g.sK),e.Y36(x.U))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-previewpoll"]],decls:7,vars:4,consts:[[2,"padding-right","11px"],["slot","start"],[3,"innerHtml"],[4,"ngIf"],["lines","full"],[1,"ion-no-padding","ion-no-margin"],["color","primary",3,"innerHtml"],["color","primary"],[2,"position","relative","top","3px","z-index","10"],["color","primary",3,"name"],[3,"lang","innerHtml"],["style","color: red;",3,"innerHtml",4,"ngIf"],[4,"ngFor","ngForOf"],["lines","none"],["lines","none","text-wrap","",1,"ion-text-end"],["size","large","color","primary","slot","end","shape","round",3,"disabled","click"],["name","paper-plane"],["color","primary",4,"ngIf"],["style","font-size: smaller;","color","primary",4,"ngIf"],["color","primary",2,"font-size","smaller"],[3,"click"],[1,"externallink",3,"innerHtml"],["name","open-outline",2,"position","relative","top","2px"],[2,"color","red",3,"innerHtml"],["value","central",3,"innerHtml"],["value","poll",3,"innerHtml"],["value","other",3,"innerHtml"]],template:function(t,o){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar",0)(2,"ion-buttons",1),e._UZ(3,"ion-menu-button"),e.qZA(),e._UZ(4,"ion-title",2),e.ALo(5,"translate"),e.qZA()(),e.YNc(6,D,43,28,"ion-content",3)),2&t&&(e.xp6(4),e.Q6J("innerHtml",e.lcZ(5,2,"previewpoll.-page-title"),e.oJD),e.xp6(2),e.Q6J("ngIf",o.ready&&null!=o.p))},dependencies:[_.sg,_.O5,l.YG,l.Sm,l.wI,l.W2,l.Gu,l.gu,l.Ie,l.q_,l.fG,l.n0,l.yW,l.wd,l.sr,g.X$],styles:['@charset "UTF-8";']}),i})()}];let b=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[s.Bz.forChild(U),s.Bz]}),i})(),Q=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[_.ez,d.u5,l.Pc,b,g.aw.forChild()]}),i})()}}]);
//# sourceMappingURL=5004.94dd4f24811255b0.js.map